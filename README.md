# OborotyNarabotka

## Функции
Считает обороты в минуту вращающегося вала мотора с помощью диска с прорезями/сверлениями и оптического датчика. Также выполняет подсчёт наработки мотора.

## Расчёт числа секторов на диске

На ATTtny85 программа выдаёт около 80k отсчётов в секунду. Для уверенного измерения оборотов необходимо 3-4 отсчёта на каждое состояние(прорезь/диск), поэтому максимальное число состояний в секунду 20k-27k. Для 24k оборотов вала мотора, 400 оборотов в секунду, имеем максимум в 34( (27000/400)/2 ) прорези на диске.

Для получения минимального количества прорезей нужно определиться с приемлемой погрешностью на минимальных измеряемых оборотах в заданном периоде сэмплирования(SMPLNG_PRD). Допустим, минимальные обороты в минуту 1k5, период сэмплирования 0.3с и погрешность измерения 0.5%. Оборотов в секунду - 25, оборотов за период сэмплирования - 7.5, погрешность - 0.0375 оборота. Погрешность соответствует одному(двум?) состояниям за период сэмплирования, соответственно:
  
    0.0375 * 2 * <число_прорезей> = 1
    <число_прорезей> = 1 / 0.075 = 13.(3)
    DISK_HLS = 14
	
Если берём период сэмплирования 1с, погрешность - 0,125 оборота:

    0.125 * 2 * <число_прорезей> = 1
    <число_прорезей> = 1 / 0.25 = 4
    DISK_HLS = 4

Для измерения оборотов мотора подсчитываются полные(!) смены состояний, поэтому реальный период сэмплирования будет меньше заданного, особенно на низких оборотах и малом числе прорезей/сверлений на диске.

## Учёт наработки

Наработка считается, если обороты мотора превышают заданное значение RPM_LIMIT. Посчитанная наработка сбрасывается, если длительность останова превысила заданное значение ZERO_BRK.

## Отображение результатов работы

Результаты отображаются на ЖКД-дисплеи типоразмера 1602 подключенного по протоколу I2C. Длительность выведения результатов на ATtiny85 около 1/3 секунды.

## Отображение отладочной информации

Если на ATtiny85 отключить функцию сброса МК(**НЕ** рекомендуется!!!) на пине PB5, то вместо наработки, при замыкании(?) этого пина на землю будет отображаться отладочная информация: учтённая длительность сэмплирования, количество полных смен состояния, общее количество отсчётов за период сэмплирования.

## Автор

kfmut, 2021г

## Лицензия

Creative Commons Zero v1.0 Universal
